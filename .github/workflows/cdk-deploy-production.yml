# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

name: cdk-deploy-production
on:
  workflow_dispatch: {}
  workflow_run:
    workflows:
      - cdk-deploy-test
    types:
      - completed
concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false
jobs:
  deploy:
    name: Deploy CDK stacks to production AWS account
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    environment: production
    if: github.event.workflow_run.conclusion == 'success'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
      - name: Setup nodejs environment
        uses: actions/setup-node@v6
        with:
          node-version: ">=22.18.0"
          cache: npm
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::123456789012:role/GitHubActionsServiceRole
          aws-region: us-east-1
      - name: Install dependencies
        run: npm ci
      - name: Run CDK synth for the PRODUCTION environment
        run: npm run production:synth
      - name: Deploy CDK to the PRODUCTION environment on AWS account 123456789012
        run: npm run production:deploy:all
